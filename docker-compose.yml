services:

  preparador:
    build: .
    volumes:
      - .:/app
    command: bash -c "./split_logs.sh"
  mapper1:
    build: .
    volumes:
      - .:/app
    command: >
      bash -c "
      mkdir -p output_usuarios output_mapreduce &&
      cat splits/split_aa | python3 mapper.py > output_mapreduce/map1.txt &&
      echo 'ðŸ”¹ Resultado del map1.txt:' $(wc -l < output_mapreduce/map1.txt) 'registros fuera de horario' > output_mapreduce/map1.out &&
      cat output_mapreduce/map1.txt >> output_mapreduce/map1.out
      "

  mapper2:
    build: .
    volumes:
      - .:/app
    command: >
      bash -c "
      mkdir -p output_usuarios output_mapreduce &&
      cat splits/split_ab | python3 mapper.py > output_mapreduce/map2.txt &&
      echo 'ðŸ”¹ Resultado del map2.txt:' $(wc -l < output_mapreduce/map2.txt) 'registros fuera de horario' > output_mapreduce/map2.out &&
      cat output_mapreduce/map2.txt >> output_mapreduce/map2.out
      "

  mapper3:
    build: .
    volumes:
      - .:/app
    command: >
      bash -c "
      mkdir -p output_usuarios output_mapreduce &&
      cat splits/split_ac | python3 mapper.py > output_mapreduce/map3.txt &&
      echo 'ðŸ”¹ Resultado del map3.txt:' $(wc -l < output_mapreduce/map3.txt) 'registros fuera de horario' > output_mapreduce/map3.out &&
      cat output_mapreduce/map3.txt >> output_mapreduce/map3.out
      "

  mapper4:
    build: .
    volumes:
      - .:/app
    command: >
      bash -c "
      mkdir -p output_usuarios output_mapreduce &&
      cat splits/split_ad | python3 mapper.py > output_mapreduce/map4.txt &&
      echo 'ðŸ”¹ Resultado del map4.txt:' $(wc -l < output_mapreduce/map4.txt) 'registros fuera de horario' > output_mapreduce/map4.out &&
      cat output_mapreduce/map4.txt >> output_mapreduce/map4.out
      "

  reducer:
    build: .
    volumes:
      - .:/app
    depends_on:
      - mapper1
      - mapper2
      - mapper3
      - mapper4
    command: >
      bash -c "
      mkdir -p output_mapreduce &&
      cat output_mapreduce/map*.txt | sort | python3 reducer.py
      "
